# STM32温湿度传感器项目

## 项目概述
本项目基于STM32F103C8T6微控制器开发，实现了温湿度数据采集、OLED显示、RTC时间显示、串口通信和LED报警等功能。

## 硬件清单
- STM32F103C8T6 核心板
- DHT11 温湿度传感器
- OLED 128x64 I2C显示屏
- 按键（2个）
- LED指示灯（2个）
- 杜邦线若干

## 硬件接线说明

### STM32F103C8T6 引脚分配

| 功能 | 引脚 | 说明 |
|------|------|------|
| DHT11数据 | PA3 | 温湿度传感器数据引脚 |
| OLED_SCL | PB8 | OLED时钟线 |
| OLED_SDA | PB9 | OLED数据线 |
| 按键1 | PB11 | 用户按键1 |
| 按键2 | PB10 | 用户按键2 |
| LED1 | PA0 | 温度报警指示灯 |
| LED2 | PA2 | 湿度报警指示灯 |
| 串口TX | PA9 | 串口发送引脚 |
| 串口RX | PA10 | 串口接收引脚 |

### 传感器接线

#### DHT11温湿度传感器
- VCC: 接3.3V
- GND: 接GND
- DATA: 接PA3（需串联10K上拉电阻）

#### OLED显示屏
- VCC: 接3.3V
- GND: 接GND
- SCL: 接PB8
- SDA: 接PB9

#### 按键
- 按键1: 一端接PB11，另一端接GND
- 按键2: 一端接PB10，另一端接GND

#### LED指示灯
- LED1: 一端接PA0，另一端接GND（低电平点亮）
- LED2: 一端接PA2，另一端接GND（低电平点亮）

## 实现功能

### 1. 温湿度数据采集与显示
- 通过DHT11传感器采集环境温湿度
- 温度测量范围：0-50℃，精度±2℃
- 湿度测量范围：20-90%RH，精度±5%RH
- 采集频率：1次/秒
- OLED显示格式：
  - 第一行：Temp: XX.X℃
  - 第二行：Humi: XX.X%

### 2. RTC时间显示
- 基于外部32.768kHz晶振的实时时钟
- 时间格式：HH:MM:SS
- 掉电后时间保持
- OLED第三行显示当前时间

### 3. 串口通信
- 波特率：115200
- 数据格式：8位数据位，1位停止位，无校验位
- 输出格式："Temp=XX.XC  Humi=XX.X%\r\n"
- 支持通过串口设置温湿度阈值
  - 设置温度阈值："SET:TMAX=35\r\n"
  - 设置湿度阈值："SET:HMAX=75\r\n"

### 4. 温湿度报警功能
- 默认温度阈值：30℃
- 默认湿度阈值：70%
- 温度超过阈值时，LED1点亮
- 湿度超过阈值时，LED2点亮
- OLED第四行显示当前阈值设置

### 5. 按键功能
- 按键1：预留功能
- 按键2：预留功能

## 代码结构

```
温湿度传感器/
├── Library/          # STM32F10x标准库文件
├── Startup/          # 启动文件
├── User/             # 用户应用代码
│   ├── Delay.c/h     # 延时函数
│   ├── dht11.c/h     # DHT11传感器驱动
│   ├── Key.c/h       # 按键驱动
│   ├── LED.c/h       # LED驱动
│   ├── OLED.c/h      # OLED驱动
│   ├── RTC.c/h       # RTC实时时钟驱动
│   ├── uart.c/h      # 串口驱动
│   ├── main.c        # 主程序
└── project.uvprojx   # Keil工程文件
```

## 使用说明

### 1. 硬件连接
按照"硬件接线说明"连接所有硬件设备。

### 2. 编译下载
- 使用Keil MDK编译工程
- 通过ST-Link或J-Link下载程序到STM32开发板

### 3. 功能测试
- 上电后OLED显示温湿度数据和当前时间
- 通过串口助手查看输出数据（波特率115200）
- 通过串口命令设置温湿度阈值
- 当温湿度超过阈值时，相应的LED指示灯会点亮

## 注意事项

1. **DHT11传感器**
   - 数据引脚PA3需要串联10K上拉电阻
   - 供电电压使用3.3V，避免5V直接接入STM32引脚
   - 采样频率不要超过1次/秒

2. **OLED显示屏**
   - 默认使用I2C接口，地址为0x78
   - 确保I2C接线正确，避免虚接

3. **串口通信**
   - 确保串口助手波特率设置为115200
   - TX/RX引脚不要接反

4. **RTC时钟**
   - 需要外部32.768kHz晶振才能正常工作
   - 如果没有外部晶振，可以修改代码使用内部RC时钟

## 故障排除

- **OLED不显示**：检查I2C接线是否正确，确保VCC和GND连接正常
- **DHT11读取错误**：检查数据引脚接线，确认上拉电阻是否连接
- **串口无输出**：检查串口接线，确认波特率设置正确
- **RTC时间不准确**：检查外部晶振是否连接，或更换晶振

## 版本历史

- V1.0：基本功能实现，包含温湿度采集、OLED显示、串口输出
- V1.1：增加RTC时间显示功能
- V1.2：增加温湿度阈值报警功能
- V1.3：完善LED控制和按键功能

---

**作者**：STM32开发者  
**日期**：2023-XX-XX